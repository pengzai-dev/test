<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <div id="app">
      <h1>{{ name }}</h1>
      <div class="article">
        <h2>{{ title }}</h2>
        <span>创建时间：{{ time }}</span>
        <p>{{ content }}</p>
      </div>
    </div>
    <script>
      const vm = new Vue({
        el: "#app",
        data: {
          name: "我的博客",
          title: "第一篇博客",
          time: "2018-12-10",
          content: "今天发布了我的第一篇博客，非常开心。"
        }
      });
      
      function Vue(options = {}) {
        this.$options = options;
        this._data = this.$options.data;
        this.setState = function(key, value) {
          this._data[key] = value;
        };
        new Render(this.$options.el, this);
      }

      function Render(el, vm) {
        vm.$el = document.querySelector(el);
        const fragment = document.createDocumentFragment();
        let child = null;
        while ((child = vm.$el.firstChild)) {
          fragment.append(child);
        }
        replace(fragment);
        vm.$el.append(fragment);
        function replace(fragment) {
          const pattern = /\{\{(.*)\}\}/;
          Array.from(fragment.childNodes).forEach(node => {
            let text = node.textContent;
            if (node.nodeType === 3 && pattern.test(text)) {
              const key = RegExp.$1.trim();
              node.textContent = text.replace(pattern, vm._data[key]);
            }
            if (node.childNodes && node.childNodes.length) {
              replace(node);
            }
          });
        }
      }
    </script>
  </body>
</html>
